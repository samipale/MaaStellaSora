<!DOCTYPE html>
<html lang="zh-CN">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MaaStellaSora - 星塔助手</title>
    <style>
        /* ================= 全局变量与重置 ================= */
        :root {
            --primary-color: #007AFF;
            --primary-hover: #0056b3;
            --bg-color: #f8f9fa;
            --text-main: #1d1d1f;
            --grid-line: rgba(0, 122, 255, 0.1);
            --transition: all 0.4s cubic-bezier(0.25, 0.8, 0.25, 1);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, "Noto Sans SC", sans-serif;
            color: var(--text-main);
            background-color: var(--bg-color);
            overflow-x: hidden;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
        }

        /* ================= 右上角 GitHub 悬浮按钮 ================= */
        .github-stats-btn {
            position: fixed;
            /* 固定定位 */
            top: 20px;
            right: 20px;
            z-index: 1000;
            /* 确保在最上层 */

            display: flex;
            align-items: center;
            gap: 8px;

            background: rgba(255, 255, 255, 0.8);
            /* 轻微透明背景 */
            backdrop-filter: blur(8px);
            /* 毛玻璃效果 */
            -webkit-backdrop-filter: blur(8px);

            padding: 8px 16px;
            border-radius: 20px;
            border: 1px solid rgba(0, 0, 0, 0.05);

            text-decoration: none;
            color: #24292e;
            font-weight: 600;
            font-size: 0.9rem;
            transition: var(--transition);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.08);
            cursor: pointer;
        }

        .github-stats-btn:hover {
            background: white;
            transform: translateY(-2px);
            box-shadow: 0 6px 16px rgba(0, 0, 0, 0.12);
        }

        .star-num {
            background: #e1e4e8;
            padding: 2px 8px;
            border-radius: 10px;
            font-size: 0.85em;
            color: #24292e;
            min-width: 24px;
            text-align: center;
        }

        /* ================= 动态背景 Canvas ================= */
        #bg-canvas {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: -1;
            background: radial-gradient(circle at 50% 50%, #ffffff, #eef2f5);
        }

        /* ================= 主要内容区域 ================= */
        main {
            flex: 1;
            width: 100%;
            /* 增加顶部 padding 以避开右上角的按钮，防止遮挡 */
            padding: 80px 5% 50px;
            display: flex;
            align-items: center;
            justify-content: center;
            position: relative;
            z-index: 2;
        }

        .hero-container {
            max-width: 1200px;
            width: 100%;
            display: flex;
            align-items: center;
            justify-content: space-between;
            gap: 50px;
        }

        /* 左侧文本区域 */
        .hero-content {
            flex: 1;
            opacity: 0;
            transform: translateY(30px);
            animation: slideUpFade 0.8s forwards 0.3s;
        }

        .hero-badge {
            display: inline-block;
            padding: 6px 12px;
            background: rgba(0, 122, 255, 0.1);
            color: var(--primary-color);
            border-radius: 20px;
            font-size: 0.85rem;
            font-weight: 600;
            margin-bottom: 25px;
            border: 1px solid rgba(0, 122, 255, 0.2);
            font-variant-numeric: tabular-nums;
        }

        /* 标题容器 */
        .title-wrapper {
            margin-bottom: 20px;
        }

        /* 标题样式统一 */
        .main-title {
            font-size: 3.5rem;
            font-weight: 700;
            line-height: 1.1;
            letter-spacing: -1px;
            margin: 0;
        }

        .title-en {
            color: var(--text-main);
            display: block;
            margin-bottom: 4px;
        }

        .title-cn {
            color: var(--primary-color);
            display: block;
            margin-top: 4px;
        }

        .description {
            font-size: 1.2rem;
            color: #666;
            margin-bottom: 40px;
            max-width: 500px;
            line-height: 1.5;
        }

        /* 按钮组 */
        .btn-group {
            display: flex;
            gap: 20px;
            flex-wrap: wrap;
        }

        .btn {
            padding: 14px 32px;
            border-radius: 12px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: var(--transition);
            border: none;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            text-decoration: none;
            position: relative;
            overflow: hidden;
        }

        .btn i {
            margin-right: 8px;
        }

        /* 主下载按钮 */
        .btn-primary {
            background-color: #24292e;
            color: white;
            box-shadow: 0 4px 15px rgba(36, 41, 46, 0.3);
        }

        .btn-primary:hover {
            background-color: #000;
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.4);
        }

        .btn:disabled {
            opacity: 0.7;
            cursor: wait;
        }

        /* Mirror 按钮 */
        .btn-outline {
            background-color: white;
            color: var(--text-main);
            border: 2px solid #e0e0e0;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.05);
        }

        .btn-outline:hover {
            border-color: var(--primary-color);
            color: var(--primary-color);
            transform: translateY(-2px);
        }

        /* 右侧角色区域 */
        .hero-image {
            flex: 1;
            display: flex;
            justify-content: flex-end;
            position: relative;
            z-index: 2;
            opacity: 0;
            animation: fadeIn 1s forwards 0.6s;
        }

        .character-wrapper {
            position: relative;
            width: 100%;
            max-width: 500px;
            animation: float 6s ease-in-out infinite;
        }

        .character-img {
            width: 100%;
            height: auto;
            filter: drop-shadow(0 20px 30px rgba(0, 0, 0, 0.15));
            object-fit: contain;
        }

        .decoration-circle {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 80%;
            height: 80%;
            border-radius: 50%;
            background: radial-gradient(circle, rgba(0, 122, 255, 0.05) 0%, rgba(255, 255, 255, 0) 70%);
            z-index: -1;
            pointer-events: none;
        }

        /* Toast 提示框 */
        .toast {
            position: fixed;
            bottom: 30px;
            left: 50%;
            transform: translateX(-50%) translateY(50px);
            background: rgba(0, 0, 0, 0.8);
            color: white;
            padding: 12px 24px;
            border-radius: 50px;
            font-size: 0.95rem;
            z-index: 2000;
            opacity: 0;
            transition: all 0.4s ease;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .toast.show {
            opacity: 1;
            transform: translateX(-50%) translateY(0);
        }

        /* ================= 关键帧动画 ================= */
        @keyframes float {
            0% {
                transform: translateY(0px) rotate(0deg);
            }

            50% {
                transform: translateY(-20px) rotate(1deg);
            }

            100% {
                transform: translateY(0px) rotate(0deg);
            }
        }

        @keyframes fadeIn {
            to {
                opacity: 1;
            }
        }

        @keyframes slideUpFade {
            from {
                opacity: 0;
                transform: translateY(30px);
            }

            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        /* ================= 响应式调整 ================= */
        @media (max-width: 900px) {
            .hero-container {
                flex-direction: column-reverse;
                text-align: center;
                gap: 40px;
            }

            .hero-content {
                display: flex;
                flex-direction: column;
                align-items: center;
            }

            .main-title {
                font-size: 2.5rem;
            }

            .description {
                max-width: 100%;
            }

            .btn-group {
                justify-content: center;
            }

            .hero-image {
                justify-content: center;
                width: 80%;
            }

            /* 移动端调整按钮位置防止遮挡 */
            .github-stats-btn {
                top: 10px;
                right: 10px;
                padding: 6px 12px;
            }

            /* 移动端隐藏文字只留图标和数字，更简洁 */
            .github-stats-btn span:not(.star-num) {
                display: none;
            }
        }
    </style>
    <!-- 引入 FontAwesome 图标库 -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
</head>

<body>

    <!-- 右上角 GitHub 悬浮按钮 -->
    <a href="https://github.com/MaaStellaSora/MaaStellaSora" target="_blank" class="github-stats-btn">
        <i class="fa-brands fa-github"></i>
        <span>Star</span>
        <span id="star-count" class="star-num">...</span>
    </a>

    <!-- 动态背景 -->
    <canvas id="bg-canvas"></canvas>

    <!-- 核心展示区 -->
    <main>
        <div class="hero-container">
            <!-- 左侧文字 -->
            <div class="hero-content">
                <span class="hero-badge" id="versionBadge">检查更新中...</span>

                <div class="title-wrapper">
                    <h1 class="main-title title-en">MaaStellaSora</h1>
                    <h2 class="main-title title-cn">星塔助手</h2>
                </div>

                <p class="description">
                    星塔助手（MaaStellaSora）提供对于游戏《星塔旅人》的自动签到、清理日常等功能，由 MaaFramework 强力驱动
                </p>

                <div class="btn-group">
                    <a href="#" class="btn btn-primary" id="githubDownloadBtn">
                        <i class="fa-brands fa-github"></i> <span id="downloadText">立即从 Github 下载</span>
                    </a>
                    <a href="https://mirrorchyan.com/zh/projects?rid=SSAH&os=windows&arch=x64&channel=stable"
                        target="_blank" class="btn btn-outline">
                        <i class="fa-solid fa-cloud-arrow-down"></i> Mirror酱下载
                    </a>
                </div>
            </div>

            <!-- 右侧角色图 -->
            <div class="hero-image">
                <div class="character-wrapper">
                    <div class="decoration-circle"></div>
                    <img src="https://raw.githubusercontent.com/MaaStellaSora/MaaStellaSora/main/assets/logo.png"
                        alt="MaaStellaSora Logo" class="character-img">
                </div>
            </div>
        </div>
    </main>

    <!-- Toast 提示框 -->
    <div class="toast" id="toast">
        <i class="fa-solid fa-circle-info"></i>
        <span id="toastMsg">Notification</span>
    </div>

    <script>
        // ================= 配置与状态 =================
        const DEFAULT_VERSION = 'v0.7.7-fix-1';
        let currentVersion = DEFAULT_VERSION;

        const CONFIG = {
            repo: 'MaaStellaSora/MaaStellaSora',
        };

        // ================= 1. 获取仓库 Star 数 =================
        async function fetchRepoStats() {
            try {
                const response = await fetch(`https://api.github.com/repos/${CONFIG.repo}`);
                if (!response.ok) throw new Error('Repo API failed');

                const data = await response.json();
                const stars = data.stargazers_count;

                document.getElementById('star-count').textContent = stars;
            } catch (error) {
                console.warn('Failed to fetch repo stats:', error);
                document.getElementById('star-count').textContent = '-';
            }
        }

        // ================= 2. 动态获取 Github 版本 =================
        async function fetchLatestVersion() {
            try {
                const response = await fetch(`https://api.github.com/repos/${CONFIG.repo}/releases/latest`);
                if (!response.ok) throw new Error('Release API failed');

                const data = await response.json();
                const latestTag = data.tag_name;

                if (latestTag) {
                    currentVersion = latestTag;
                    updateUIWithNewVersion();
                }
            } catch (error) {
                console.warn('Failed to fetch version, using default:', error);
            }
        }

        function updateUIWithNewVersion() {
            document.getElementById('versionBadge').textContent = currentVersion;
            updateGithubButton();
        }

        // ================= 3. Github 下载链接构建逻辑 =================
        function getDownloadInfo(version) {
            const userAgent = navigator.userAgent;
            const platform = navigator.platform;

            let os = 'unknown';
            let arch = 'x86_64';
            let ext = '';
            let label = '';
            let isSupported = true;

            if (platform.indexOf('Mac') !== -1 || userAgent.indexOf('Mac') !== -1) {
                os = 'macos';
                ext = 'tar.gz';
                label = 'macOS';
                if (platform === 'MacARM' || (typeof navigator.userAgentData !== 'undefined' && navigator.userAgentData.platform === 'macOS' && navigator.userAgentData.architecture === 'arm')) {
                    arch = 'aarch64';
                    label = 'macOS (Apple Silicon)';
                }
            } else if (platform.indexOf('Win') !== -1) {
                os = 'win';
                ext = 'zip';
                label = 'Windows';
            } else if (platform.indexOf('Linux') !== -1 || userAgent.indexOf('Linux') !== -1) {
                os = 'linux';
                ext = 'tar.gz';
                label = 'Linux';
            } else if (/Android/.test(userAgent) || /iPhone|iPad|iPod/.test(userAgent)) {
                os = 'mobile';
                isSupported = false;
            }

            const baseUrl = `https://gh-proxy.com/https://github.com/${CONFIG.repo}/releases/download/${version}`;
            const fileName = `MaaStellaSora-${os}-${arch}-${version}.${ext}`;
            const fullUrl = `${baseUrl}/${fileName}`;

            return { os, arch, label, isSupported, fullUrl, fileName };
        }

        function updateGithubButton() {
            const btn = document.getElementById('githubDownloadBtn');
            const info = getDownloadInfo(currentVersion);

            if (!info.isSupported) {
                btn.onclick = (e) => {
                    e.preventDefault();
                    showToast('请使用 PC 端访问以下载软件', 'warning');
                };
                btn.style.backgroundColor = '#666';
                btn.style.opacity = '0.7';
                document.getElementById('downloadText').textContent = '不支持当前系统';
                return;
            }

            const textSpan = document.getElementById('downloadText');
            textSpan.textContent = `立即从 Github 下载 (${info.label})`;

            btn.href = info.fullUrl;
            btn.setAttribute('download', info.fileName);
            btn.removeAttribute('onclick');

            btn.addEventListener('click', (e) => {
                showToast(`正在跳转下载: ${info.fileName}...`);
            });
        }

        function showToast(message, type = 'info') {
            const toast = document.getElementById('toast');
            const msg = document.getElementById('toastMsg');

            msg.textContent = message;
            toast.classList.add('show');

            if (type === 'warning') toast.style.background = 'rgba(255, 167, 38, 0.9)';
            else toast.style.background = 'rgba(0,0,0,0.8)';

            setTimeout(() => {
                toast.classList.remove('show');
            }, 3000);
        }

        // ================= 4. Canvas 背景动效 =================
        const canvas = document.getElementById('bg-canvas');
        const ctx = canvas.getContext('2d');

        let width, height;
        let particles = [];
        const gridSpacing = 60;
        const gridSpeed = 0.5;

        function resize() {
            width = canvas.width = window.innerWidth;
            height = canvas.height = window.innerHeight;
        }

        class Particle {
            constructor() {
                this.x = Math.random() * width;
                this.y = Math.random() * height;
                this.vx = (Math.random() - 0.5) * 0.5;
                this.vy = (Math.random() - 0.5) * 0.5;
                this.size = Math.random() * 3 + 1;
                this.alpha = Math.random() * 0.5 + 0.1;
            }

            update() {
                this.x += this.vx;
                this.y += this.vy;
                if (this.x < 0) this.x = width;
                if (this.x > width) this.x = 0;
                if (this.y < 0) this.y = height;
                if (this.y > height) this.y = 0;
            }

            draw() {
                ctx.fillStyle = `rgba(0, 122, 255, ${this.alpha})`;
                ctx.beginPath();
                ctx.arc(this.x, this.y, this.size, 0, Math.PI * 2);
                ctx.fill();
            }
        }

        function initParticles() {
            particles = [];
            const count = Math.floor(width * height / 20000);
            for (let i = 0; i < count; i++) {
                particles.push(new Particle());
            }
        }

        let offset = 0;

        function animate() {
            ctx.clearRect(0, 0, width, height);
            ctx.strokeStyle = 'rgba(0, 122, 255, 0.08)';
            ctx.lineWidth = 1;
            offset = (offset + gridSpeed) % gridSpacing;

            for (let x = offset; x < width; x += gridSpacing) {
                ctx.beginPath();
                ctx.moveTo(x, 0);
                ctx.lineTo(x, height);
                ctx.stroke();
            }
            for (let y = 0; y < height; y += gridSpacing) {
                ctx.beginPath();
                ctx.moveTo(0, y);
                ctx.lineTo(width, y);
                ctx.stroke();
            }

            particles.forEach(p => {
                p.update();
                p.draw();
            });
            requestAnimationFrame(animate);
        }

        // ================= 初始化流程 =================
        window.addEventListener('resize', () => {
            resize();
            initParticles();
        });

        resize();
        initParticles();
        animate();

        updateGithubButton();

        Promise.all([
            fetchRepoStats(),
            fetchLatestVersion()
        ]);

    </script>
</body>

</html>